<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Products</title>
  <style>
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid black; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    #feedbackMessage { margin: 10px 0; font-weight: bold; }
    form { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Products</h1>

  <!-- Navigation -->
  <nav style="background-color: #333; padding: 10px; margin-bottom: 20px;">
    <ul style="list-style: none; margin: 0; padding: 0; display: flex; gap: 15px;">
      <li><a href="index.html" style="color: white; text-decoration: none;">Home</a></li>
      <li><a href="customers.html" style="color: white; text-decoration: none;">View Customers</a></li>
      <li><a href="products.html" style="color: white; text-decoration: none;">View Products</a></li>
      <li><a href="orders.html" style="color: white; text-decoration: none;">View Orders</a></li>
      <li><a href="order_details.html" style="color: white; text-decoration: none;">View Order Details</a></li>
    </ul>
  </nav>

  <!-- Feedback Message -->
  <div id="feedbackMessage"></div>

  <!-- Filter Dropdown -->
  <label for="productSelect">Filter By:</label>
  <select id="productSelect" name="productSelect">
    <option value="aToz">Alphabetical</option>
    <option value="categoryOption">Category</option>
    <option value="hightoLow">Price High to Low</option>
    <option value="lowtoHigh">Price Low to High</option>
  </select>

  <!-- Products Table -->
  <div id="productTable">
    <table>
      <thead>
        <tr>
          <th>Product Name</th>
          <th>Price</th>
          <th>Category</th>
          <th>Quantity Left</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>

  <!-- Add New Product Form -->
  <h2>Add New Product</h2>
  <form id="addProductForm">
    <label for="productName">Product Name:</label>
    <input type="text" id="productName" name="productName" required>
    <label for="price">Price:</label>
    <input type="number" id="price" name="price" step="0.01" required>
    <label for="category">Category:</label>
    <input type="text" id="category" name="category" required>
    <label for="quantity">Quantity:</label>
    <input type="number" id="quantity" name="quantity" required>
    <button type="submit">Add Product</button>
  </form>

  <script>
    // Fetch and display products
    async function fetchProducts() {
      const response = await fetch('/products');
      const products = await response.json();

      const tableBody = document.querySelector('#productTable tbody');
      tableBody.innerHTML = ''; // Clear existing rows

      products.forEach(product => {
        const row = `
          <tr>
            <td>${product.productName}</td>
            <td>$${product.priceValue.toFixed(2)}</td>
            <td>${product.categoryItem}</td>
            <td>${product.quantityLeft}</td>
            <td>
              <button onclick="editProduct(${product.productID})">Update</button>
              <button onclick="deleteProduct(${product.productID})">Delete</button>
            </td>
          </tr>
        `;
        tableBody.insertAdjacentHTML('beforeend', row);
      });
    }

    // Handle form submission to add a product
    document.getElementById('addProductForm').addEventListener('submit', async (event) => {
      event.preventDefault(); 

      const formData = new FormData(event.target);
      const data = Object.fromEntries(formData.entries());

      const response = await fetch('/products/add', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });

      if (response.ok) {
        showMessage('Product added successfully!', true);
        fetchProducts(); 
        event.target.reset(); 
      } else {
        showMessage('Failed to add product.', false);
      }
    });

    // Delete product
    async function deleteProduct(id) {
      const response = await fetch(`/products/${id}`, { method: 'DELETE' });
      if (response.ok) {
        showMessage('Product deleted successfully!', true);
        fetchProducts();
      } else {
        showMessage('Failed to delete product.', false);
      }
    }

    // Show feedback message
    function showMessage(message, isSuccess = true) {
      const feedback = document.getElementById('feedbackMessage');
      feedback.textContent = message;
      feedback.style.color = isSuccess ? 'green' : 'red';
      setTimeout(() => feedback.textContent = '', 3000); // Clear after 3 seconds
    }

    // Fetch products on page load
    document.addEventListener('DOMContentLoaded', fetchProducts);
  </script>
</body>
</html>
